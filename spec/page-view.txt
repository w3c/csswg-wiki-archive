====== Page View ======
"Page view" or "paged view" as a term relates broadly to the kind of presentation where content is laid out in discreet pages and shown to user one page at a time (or several pages at a time). 

Wide variety of paged view situations require same or similar support from core layout engine -- primarily the ability to flow content into multiple containers, thus producing multiple boxes with fragments of content (see "[[Fragments, Columns, Regions, Pages]]"). Solutions differ in how the fragmentation functionality is invoked.

The problems to be solved in implementing paged views revolve around encoding the design intent and UI behavior, both requiring novel approaches: design intent often derives from experience in print media, which must become adaptive to target multiple devices and resolutions; UI of navigating pages on screen also doesn’t have established tradition, although many implementations use similar concepts.

This set of use cases shows some expected uses of paged views.

Uses cases, analysis and proposals found here probably don’t correspond to a single specification. The goal here is to get a holistic view of each case, which will help to compare proposals and understand relative importance of lower level problems.

====== Use Cases ======

===== Page view in window or element =====

**Goal:** easy declarative way to create paged view, good behavior with default settings and default UI.

<html>
<div style="display:inline-block; width:9em;">

<div style="background:gray; --padding:1em; text-align:justify; vertical-align:middle;">
  <div style="background:white;border:1px solid black; --width:7em; padding:1em; text-align:justify">
    <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</div>
  </div>
  <div style="text-align:justify; padding:0 1em;">
    <div style="display:inline-block; color:lightgray; font-size:1.2em;">&lt;&lt;&lt;</div>
    <div style="display:inline-block; color:lightgray; font-size:1.2em;">&gt;&gt;&gt;</div>
    <div style="display:inline-block; width:6em; height:0; visibility:hidden"></div>
  </div>
</div>
</div>
</html>

**Proposal:**
  * New value for 'overflow property: **"overflow:paged"**

**Example:**
  div.book { overflow:paged }
Element with "overflow:paged" shows one page of content at a time. 

All pages are of the same size - the size of content area of the element.

UI is provided by UA, it may be jestures on touch device, or page navigation controls (perhaps similar to controls on <video> element)

**Example:**
  html { width:100%; height:100%; overflow:paged }
This should put the whole document in paged view. If UA is also in full screen mode, this works particularly well on tablet devices as full-screen reading mode

**Example:**
  iframe.magazine { overflow:paged }
Presents content of a separate document in paged view. Can be used to build a page viewer with custom UI.

**Issues:** 
  * May need additional layout options or constraints
    * Page size
    * Min/max number of pages (maybe)
  * Possible page presentation options
    * Facing pages?
    * Direction of flipping pages?
  * Add a way to customize pages (page numbers, headers, footers)?
  * Dealing variable-sized pages is not yet defined and may be limited in this simple case

===== Page view with custom controls =====

**Goal:** Add custom controls to paged view.

Ideally, UA should provide well designed, usable and accessible controls for pagination. There will inevitably be situations however that require custom UI, for style or to provide unique functions. It could look like this:

<html>
<div style="display:inline-block">
<div style="height:2em; background:black; padding:0.5em 1em; font-family:sans-serif; font-weight:bold; text-align:center;">
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">print</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">share</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&lt;</div>
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em; font-weight:normal">page #</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&gt;</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">zoom</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">bookmark</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em 5em 0.25em 0.25em ; font-weight:normal">&nbsp;</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">search</div>
</div>

<div style="background:gray; padding:1em; text-align:center;">
    <div style="display:inline-block;background:white;border:1px solid black; width:7em; padding:1em; text-align:justify">
      Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</div>
</div>
</div>
</html>

Custom controls will activate custom script, which in some cases will need to access pagination results or modify the view.

Implementation of custom page UI needs some or all of the following:
  * Modify or replace the default pagination UI
  * Know number of pages
  * Show a particular page
  * Know if everything fits (in automatic page layout, there will be alwayse enough pages generated, but there may be unprocessed content due to timing or additional constraints)
  * Determine what content is in a given page (a potentially disjoint range of content)
  * Determine on what page or pages a given range of content is
  * Determine if content of interest didn't fit on any page
  * Find content that intersects with a point or shape, relative to a given page or current page
  * Find exact coordinates and page(s) of laid out content
  * Know when number of pages changes or layout of content on a page changes

To achieve that, pages and paged viewer need exposure in styles and OM

====Proposals====

**Control default UI with 'overflow' property** (([[http://dev.w3.org/csswg/css3-gcpm/#paged-presentations|GCPM - ED]]))
  * overflow-style:<existing values>|paged-x|paged-y|paged-x-controls|paged-y-controls

Example:
<code>
  .pager { overflow:paged-x; }
  <div class="pageview">
    <div class="toolbar">
      <button onclick="PrevPage()">previous</button>
      <button onclick="NextPage()">next</button>
      ...
    </div>
    <div class="pages">
      <iframe class="pager" src="content.html"></iframe>
    </div>
  </div>
</code>

====Ideas====
===Paged View DOM===
//There are no formal proposals on OM for overflow:paged at this time. Note that API is similar to what regions expose for same purposes//

To support custom pagination UI, overlfow:paged needs to expose equivalent of offsetTop/offsetLeft/offsetHeight/offsetWidth/srollTop/scrollHeight (which are used for cusotm control of scrollable elements).

//The API will have to include the following members, or equivalent://

  * **interface PagedView** -- implemented on HTMLElement (and maybe on HTMLDocument). Alternatively all members are exposed directly on element (that would match scope of scroll API)
  * **PagedView Element.pagedView** -- paged view of element's content. NULL if not applicable
  * **int PagedView.pageCount** -- get number of pages
This should wait synchronously for content pagination to be completed, if needed, following the patter of 'offsetHeight' etc. (which always return correct value, forcing synchronous layout)
  * **void PagedView.showPage(pageNumber)**
  * **int[] PagedView.getPagesFromContentNode(Node contentNode)** -- get page numbers for pages that show any portion of given node
  * **Rect[] PagedView.rectsOnPage(pageNumber, Node contentnode)** -- get bounding rects of content rendering on specific page
  * **Range[] PagedView.getContentRangesOnPage(pageNumber)** -- range(s) of content that falls on that page
  * **Node elementFromPoint(pageNumber, x, y)** -- element under the point, in coordinates of the page

//**Events?** -- should there be an event for layout change? maybe not, unlike regions: all content is inside the viewer element, content change events should be enough//

**Example**
  TODO: example of script with page view API
===== Page view with custom pages =====

**Goal:** Apply content formatting to specific pages and position pages on screen

<html>
<div style="display:inline-block">
<div style="height:2em; background:black; padding:0.5em 1em; font-family:sans-serif; font-weight:bold; text-align:center;">
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">print</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">share</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&lt;</div>
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em; font-weight:normal">page #</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&gt;</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">zoom</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">bookmark</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em 5em 0.25em 0.25em ; font-weight:normal">&nbsp;</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">search</div>
</div>

<div style="background:gray; padding:1em; text-align:center;">
    <div style="display:inline-block;background:white;border:1px solid black; margin:0.5em">
    <div style="width:6.5em; height:9em; margin:1em; overflow:hidden; text-align:justify; color:green;">
      Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. Fusce     </div>
    </div>

    <div style="display:inline-block;background:white;border:1px solid black; margin:0.5em">
    <div style="width:6.5em; height:9em; margin:1em; overflow:hidden; text-align:justify; color:blue;">
posuere, magna sed pulvinar ultricies, purus lectus malesuada libero, sit amet commodo magna eros quis urna.
    </div>
    </div>
</div>
</div>
</html>
  * left page has green text, right page has blue text
  * even and odd pages are positioned differently to create a two-page view

====Ideas====
**Page selectors**

  #paged { width:6.5in; height:9in; overflow:paged; }
  #paged * { border: 1px solid black; }
  #paged::nth-child(even) { position:relative; left:<page-width> } /**


**Page View DOM**

//There are no formal proposals on OM for overflow:paged at this time. Note that API is similar to what regions expose for same purposes//

In addition to API for page display, DOM for custom paged view needs writable access to page size and position
  * int PagedView.**pageWidth**(pageNumber)
  * int PagedView.**pageHeight**(pageNumber)
  * void PagedView.**setPageWidth**(pageNumber)
  * void PagedView.**setPageHeight**(pageNumber)

Content properties can be set by detecting range(s) of content on page, then traversing content and applying properties. Of course care has to be taken as it can't be assumed that modified content will still fit the same page.

**Example:**
  TODO
===== Magazine viewer =====

**Goal:** enable complex page design with multiple content flows and graphics, approaching or exceeding capabilities of print design

A magazine article (pretty simple one) could look like this. 

{{:spec:magazine1.png}}

The user reads the magazine in a reader application, {{ :spec:magazine2.png}} with same options for page navigation control as in previous examples of page view. 

Each individual page can have unique design and can include content from multiple sources: multiple text streams (main story, side bar, pull quotes) and images (some included in text, some placed directly as related visuals or advertisements).

//Note that at this point we don't make assumptions on how exactly each "page" is constructed. It may be automatically generated with some adaptive mechanism or it may be manually put together by a design team with print design experience. That distinction will be important for next use case, here we are looking at ways to represent the layout//

**TODO:** Add an example of template with columns, floating image, pullquote

<html><div style="clear:both"></div></html>
====Proposals====
===[css3-regions] with script===
  TODO Page view, UI, page generation is done in script  

====Ideas====
//**If** it is possible to achieve same results with further extensions of 'overflow:paged', ideas should go here//

**Issues:** 
  * No declarative way to generated additional regions or pages is yet defined


===== Adaptive magazine pages with templates =====

**Goal:** automatically generate complex pages based on content, encoded design intent and media properties

{{ :spec:magpageportrait.png}}{{ :spec:magpagelandscape.png}}

Online magazine must work on devices on different sizes, resolution and orientation. Just as any other adaptive content using media queries, same magazine will look very different on different devices.

Same content may end up on different pages, order of content may change, and content may change too (different images may be used in different orientation, some images may be dropped, some text may be replaced with links).

<html><div style="clear:both"></div></html>

====Proposals====
===[css3-regions] with script===
//TODO:script for page content/overlow change, events//

===IDPF page templates proposal===
  * [[http://epub-revision.googlecode.com/svn-history/r3025/trunk/src/proposals/css_page_templates/csspgt-doc.xhtml | IDPF Page Templates Proposal]] has a range of ideas

//TODO:examples//
  
**Issues:** 

===== Column breaks and page breaks in regions =====

**Goal:** provide a way to control layout in columns and pages, when columns, pages or both are parts of a template-based paged view

In magazine layout, what user percieves as "columns" can have irregular shape and position (and may be regions rather than boxes of multicol layout) and be placed to "pages" in a custom way.

Content flown throuh such "colums" needs to be able to use column breaks and page breaks, for example to make sure that a new chapter starts at a new page:

<HTML>
  <div id="page1" class="pageFrame" style="float:left; background:white; border:2px solid blue; margin:1em; width:18em; height:22em;">
    <div class="pageContent" style="margin:2em; width:13em; height:18em; position:relative; text-align:left; xoutline:1px solid lime">
      <div class="titleImg" style="background:salmon; width:8.3em; height:50%; float:right;"></div>
      <div class="mainStory">
        <div style="float:left; width:4em; height:18em; overflow:hidden; margin-right:0.5em;outline:2px solid green;">
          <div style="color:red; font-weight:bold">One</div>
          Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. 
          Fusce posuere, magna 
        </div> 
        <div style="float:left; width:4em; height:8.5em; overflow:hidden; margin:0.5em 0.5em 0;outline:2px solid green;">
pulvinar ultricies, purus lectus malesuada libero, sit amet 
        </div> 
        <div style="float:left; width:4em; height:8.5em; overflow:hidden; margin:0.5em -1em 0 0.5em;outline:2px solid green;">
        </div> 
      </div>
    </div>
  </div>
  
    <div id="page1" class="pageFrame" style="float:left; background:white; border:2px solid blue; margin:1em; width:18em; height:22em;">
    <div class="pageContent" style="margin:2em; width:13em; height:18em; position:relative; text-align:left; xoutline:1px solid lime">
      <div class="mainStory">
        <div style="float:left; width:4em; height:10em; overflow:hidden; margin-right:0.5em;outline:2px solid green;">
          <div style="color:red; font-weight:bold">Two</div>
          Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
        </div> 
        <div style="float:left; width:4em; height:10em; overflow:hidden; margin:4em 0.5em 0;outline:2px solid green;">
Maecenas porttitor congue massa. 
          Fusce posuere, magna sed 
        </div> 
        <div style="float:left; width:4em; height:10em; overflow:hidden; margin:8em -1em 0 0.5em;outline:2px solid green;">
          pulvinar ultricies, purus lectus malesuada libero, sit amet 
          commodo 
          </div> 
      </div>
    </div>
  </div>

<div style="clear:both"></div>

</HTML>

If "page" is an element or pseudo-element generated from template and rendered in a custom page viewer, layout engine may need additional information to know which column is first column of a page.

//Note that this may or may not be an issue, depending on how pages are built.//

**Proposal:**

**Issues:** 

====== Issues ======
Further issues (not addressed in use cases):
  * Paged view doesn't automatically mean "paged media" (which is commonly used as "for printing" and can't be repurposed). Should there be a way to declare that a paginating viewer (e.g. iframe) needs to render the same visuals as what would be printed?
  * Media queries for paged view/columns/regions?