====== Fragments, Columns, Regions, Pages ======
//Notes and examples in support of discussion on Regions//

===== Layout Engine with Fragmentation Support =====
Implementations of regions, columns and paginations will vary but in most general situation it is reasonable to assume that there is a layout engine that takes formatted content in DOM as input and fills one or more container with that content:

<html>

<div class="figure" style="border:thin solid silver; width:35em; margin:auto; padding:1em;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>

    <div style="margin:1em"></div>
    
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>

    <div style="margin:0.5em"></div>
    	
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
    </div>
</div>
</html>

That's what all layout engines do, the most common cases being 
  * Layout for screen

<html>
<div class="figure" style="border:thin solid silver; width:35em; margin:auto; padding:1em; font-size:66%; -float:right; clear:right;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>

    <div style="margin:1em"></div>
    	
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>

    <div style="margin:0.5em"></div>
    	
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:block;margin:0.5em;border:1px dashed black;padding:0.5em; border-bottom-style:none;height:3em;">
        </div>
    </div>
</div>
</html>

(there is only one container, usually with auto height) and 
  * printing

<html>
<div class="figure" style="border:thin solid silver; width:35em; margin:auto; padding:1em; font-size:66%; -float:right; clear:right;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>

    <div style="margin:1em"></div>
    	
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>

    <div style="margin:0.5em"></div>
    	
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
    </div>
</div>
</html>

(a sequence of containers, usually all of the  same size)

This doesn't yet show what layout engine do, it just shows some possible situations. It could be noted that if containers exist before layout engine has done any work, we must be assuming that containers are exernal to layout engine. That is not necessarily so, we are just trying to keep these general illustrations simple.



===== Fragmentation =====

When layout engine actually does its work, it outputs pieces of content that are laid out to fit into given containers. For the purposes of describing the layout process, let's call filling multiple containers with content "fragmentation". Then the containers can be called "space fragments" and visual representation of portions of content will be "fragment boxes". 

//Note: This is not an attempt to introduce formal definitions or terminology for fragmentation (fragmentation will have a [[spec:css4-page|dedicated module]]). The purpose of this summary is to visualize possible relationships between content, conainers and layout results, which, hopefully, will be useful for evaluation of proposed solution in this space. Feel free to correct any trems or concepts if they look inconsistent with formal definitions elsewhere//

<html>
<div class="figure" style="border:thin solid silver; width:35em; margin:auto; padding:1em;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="legend" style="font-style:italic">Fragment boxes</div>
    <div style="text-align:center">
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        Lorem
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        ipsum
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        dolor
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        sit
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        amet
        </div>
    </div>
    
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em; ">
        </div>
    </div>
</div>

</html>

Note that as layout engine fills containers with content, there may be content than there is space in containers:

<html>
<div class="figure" style="border:thin solid silver; width:35em; font-size:66%; margin:auto; padding:1em;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="legend" style="font-style:italic">Fragment boxes</div>
    <div style="text-align:center">
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        Lorem
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        ipsum
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        dolor
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        sit
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:#ff8888;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        amet
        </div>
    </div>
    
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em; visibility:hidden;">
        </div>
    </div>
</div>
</html>

... and there may be more space than content:

<html>
<div class="figure" style="border:thin solid silver; width:35em; font-size:66%; margin:auto; padding:1em;">
    <div class="legend" style="font-style:italic">Content</div>
    <div class="" style="background:silver">. . . Lorem ipsum dolor sit amet, consectetur . . . </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="centerbox" style="width:10em;margin:auto;border:1px solid black;padding:0.5em;text-align:center;">
        Layout engine
    </div>
    	
    <div class="down-arrow" style="width:2em;margin:0.5em auto;">
    <div style="width:1em; height:1.5em; margin:auto; background:lightgray;"></div>
    <div style="width:0; height:0; border-width:1em 1em 0; border-style:solid; border-color:lightgray transparent;"></div>
    </div>
    
    <div class="legend" style="font-style:italic">Fragment boxes</div>
    <div style="text-align:center">
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        Lorem
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        ipsum
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        dolor
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        sit
        </div>
        <div class="fragment" style="display:inline-block;margin:0.5em;background:silver;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em; visibility:hidden;">
        amet
        </div>
    </div>
    
    <div class="legend" style="font-style:italic">Containers</div>
    <div style="text-align:center">
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed black;padding:0.5em;width:2em;height:3em;">
        </div>
        <div class="box" style="display:inline-block;margin:0.5em;border:1px dashed red;padding:0.5em;width:3em;height:2em; margin-bottom:1.5em;">
        </div>
    </div>
</div>

</html>

Which gets us to the questions of "where do the containers come from?" and "how to get more?"

===== Containers =====

Considering that a target container for fragmentation is a rectangle or shape with size and possibly position, there are many ways to create and manage theem. 

Some existing or anticipated ways to provide containers for fragmentation are

  * Columns
    * As defined in css3-multicol (available now)
    * With column selectors (proposed)
  * Pages
    * Printing or print preview (available now)
    * Automatic page view (proposed)
    * Regions+script page view (available now)
    * Page templates (proposed)
  * Regions
    * Static (available now)
    * Scripted (available now)
    * Generated (discussed)

Let's compare the different kinds of fragmenting containers, specifically looking at who is in control and how they are manated dynamically:
^ Container type ^ how created ^ dynamic ? ^ details ^
| **Columns - CSS3** | "columns:N"\\ multicol properties | partially | new columns are added in overfrlow |
| **Columns - new** | automatic | dynamic | control size & position sith column selectors:\\ article::column(2) {...} | 
| **Pages - print** | printing app or layout engine in print mode; hardcoded | dynamic | follows paged media spec; no reading UI defined beyond print preview |
| **Pages - auto paged view** | "overflow:paged" | dynamic | by default all "pages" are same size; can be customized with page selectors (like columns); default UI |
| **Pages - regions+script** | from script  | script | all custom, no declarative page generation, no default UI, all in script |
| **Pages - page templates** | automatic | dynamic | a set of templates and template selection rules; multiple flows can be supported; no default UI; can be combined with any other generated containers |
| **Regions - static** | "flow-from:<flowname>" | static | current specs don't define declarative ways to generate regions |
| **Regions - scripted** | regionOverflow, regionLayoutUpdate | script | regions spec adds minimal API for layout results and timing |


===== Use Cases =====
<html><div style="background:yellow;font-weight:bold"><i>Work in progress</i></div></html>

==== "overflow:paged" -- simple paged view====

**Goal:** easly declarative way to create paged view, good behavior with default settings and default UI.

<html>
<div style="display:inline-block; width:9em;">

<div style="background:gray; --padding:1em; text-align:justify; vertical-align:middle;">
  <div style="background:white;border:1px solid black; --width:7em; padding:1em; text-align:justify">
    <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</div>
  </div>
  <div style="text-align:justify; padding:0 1em;">
    <div style="display:inline-block; color:lightgray; font-size:1.2em;">&lt;&lt;&lt;</div>
    <div style="display:inline-block; color:lightgray; font-size:1.2em;">&gt;&gt;&gt;</div>
    <div style="display:inline-block; width:6em; height:0; visibility:hidden"></div>
  </div>
</div>
</div>
</html>

**Proposal:**
  * New value for 'overflow property: **"overflow:paged"**

**Example:**
  div.book { overflow:paged }
Element with "overflow:paged" shows one page of content at a time. 

All pages are of the same size - the size of content area of the element.

UI is provided by UA, it may be jestures on touch device, or page navigation controls (perhaps similar to controls on <video> element)

**Example:**
  html { width:100%; height:100%; overflow:paged }
This should put the whole document in paged view. If UA is also in full screen mode, this works particularly well on tablet devices as full-screen reading mode

**Example:**
  iframe.magazine { overflow:paged }
Presents content of a separate document in paged view. Can be used to build a page viewer with custom UI.

**Issues:** 
  * May need additional layout options or constraints
    * Page size
    * Min/max number of pages (maybe)
  * Possible page presentation options
    * Facing pages?
    * Direction of flipping pages?
  * Add a way to customize pages (page numbers, headers, footers)?
  * Dealing variable-sized pages is not yet defined and may be limited in this simple case

==== "overflow:paged" with custom controls ====

**Goal:** Add custom controls to paged view.

Ideally, UA should provide well designed, usable and accessible controls for pagination. There will inevitably be situations however that require custom UI, for style or to provide unique functions. It could look like this:

<html>
<div style="display:inline-block">
<div style="height:2em; background:black; padding:0.5em 1em; font-family:sans-serif; font-weight:bold; text-align:center;">
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">print</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">share</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&lt;</div>
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em; font-weight:normal">page #</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">&gt;</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">zoom</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">bookmark</div>
  &nbsp;&nbsp;
  <div style="display:inline-block; border:1px solid white; background:white; padding:0.25em 5em 0.25em 0.25em ; font-weight:normal">&nbsp;</div>
  <div style="display:inline-block; border:1px solid white; color:white; padding:0.25em">search</div>
</div>

<div style="background:gray; padding:1em; text-align:center;">
    <div style="display:inline-block;background:white;border:1px solid black; width:7em; padding:1em; text-align:justify">
      <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua</div>
    </div>
</div>
</div>
</html>


Custom controls will activate custom script, which in some cases will need to access pagination results or show a particular page.

Implementation of custom page UI needs some or all of the following:
  * Disable or extend the default pagination UI
  * Know number of pages
  * Know if everything fits (in automatic page layout, there will be alwayse enough pages generated, but there may be unprocessed content due to timing or additional constraints)
  * Show a particular page
  * Determine what content is in a given page (a potentially disjoint range of content)
  * Determine on what page or pages a given range of content is
  * Determine if content of interest didn't fit on any page
  * Find content that intersects with a point or shape, relative to a given page or current page
  * Find exact coordinates and page(s) of laid out content
  * Know when number of pages changes or layout of content on a page changes

**Proposal:**

Paged layout need to be exposed in OM, similar to how scrolling is exposed via scrollTop/scrollHeight

**Example:**

==== columns ====

**Goal:** multicolumn flow in a single defined container or in paged view

**Proposals:**
  * The existing css3-multicol module.
  * Extensions for adding control to individulal columns

**Issues:** 
  * As-is, multicol layout requires a higher-level pagination control.

==== scripted pages and paged view ====

**Goal:** enable broad range of page design and UI, including the most complicated cases seen in print magazines and experimental UI.

**Proposals:**
  * css3-regions module
  * Page view, UI, page generation is done in script  

**Issues:** 
  * No declarative way to generated additional regions or pages is yet defined


==== page templates ====

**Goal:** automatically generate complex pages based on content and encoded design intent

**Proposals:**
  * Need a proposal. 
  * [[http://epub-revision.googlecode.com/svn-history/r3025/trunk/src/proposals/css_page_templates/csspgt-doc.xhtml | IDPF Page Templates Proposal]] has a range of ideas, to converge with what is developing in recent discussions.
  
**Issues:** 

==== Column breaks and page breaks ====

**Goal:** provide a way to control layout in columns and pages, when columns, pages or both are parts of a template-based paged view

**Issues:** 

===== Issues =====
Some issues not addressed in use cases:
  * Paged view doesn't automatically mean "paged media" (which is commonly used as "for printing" and can't be repurposed). Should there be a way to declare that a paginating viewer (e.g. iframe) needs to render the same visuals as what would be printed?
  * Media queries for paged view/columns/regions?