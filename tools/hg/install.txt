====== W3C Mercurial (hg) for Dummies ======

===== What you need beforehand =====
  - A W3C member access username and password

===== Installing Mercurial =====

==== Windows ====

  * Install [[http://tortoisehg.bitbucket.org/|TortoiseHg]] to get both GUI and command line tools installed.

==== Mac OS X ====

You need to first install Mercurial on your system.

  * install XCode. It helps if you're using a fairly new OS X version (e.g. 10.6 Snow Leopard or 10.7 Lion) and XCode. XCode is available in the App Store. 
  * install MacPorts [[https://distfiles.macports.org/MacPorts/MacPorts-2.0.3-10.6-SnowLeopard.dmg|(OSX 10.6)]] [[https://distfiles.macports.org/MacPorts/MacPorts-2.0.3-10.7-Lion.dmg|(OSX 10.7)]] (see [[http://www.macports.org/install.php|Installing MacPorts]] for other installs). You do not need to install X11. If you already have MacPorts installed, be sure to update it by entering this command into a Terminal window:
<code bash>sudo port selfupdate</code>

You may be prompted to enter your password (as with any "sudo" command).

If you get an error message like:

<code>sudo: port: command not found</code>

Then you haven't successfully installed MacPorts. See above instructions to:
  * download the MacPorts installer
  * open it (e.g. if you're on OS X 10.7 Lion, open the file "MacPorts-2.0.3.pkg" inside the volume "MacPorts-2.0.3")
  * click all the obvious default install buttons, enter your password if requested and wait for the install to finish (should take less than a minute).
  * open a *new* Terminal window. You can also quit/reopen your Terminal application.

Now you should be ready to install Mercurial:

  * Install Mercurial by entering this command into a Terminal window:

<code bash>sudo port install mercurial</code>

If you get an error message like:

<code>sudo: port: command not found</code>

Then open a *new* Terminal window and try the command again:

<code bash>sudo port install mercurial</code>

You will be asked for your "Password:" - enter it.

You should then see a bunch of messages like:

<code>
Computing dependencies for mercurial
--->  Dependencies to be installed: curl-ca-bundle perl5 perl5.12 gdbm gettext expat libiconv gperf ncurses ncursesw python27 bzip2 db46 libedit openssl zlib python_select sqlite3
--->  Fetching archive for expat
--->  Attempting to fetch expat-2.0.1_1.darwin_11.x86_64.tbz2 from http://packages.macports.org/expat
--->  Fetching expat
--->  Attempting to fetch expat-2.0.1.tar.gz from http://lil.fr.distfiles.macports.org/expat
--->  Verifying checksum(s) for expat
--->  Extracting expat
--->  Configuring expat
--->  Building expat
--->  Staging expat into destroot
--->  Installing expat @2.0.1_1
--->  Activating expat @2.0.1_1
--->  Cleaning expat
--->  Fetching archive for gperf
...
</code>

In order to supply all the packages Mercurial depends on, MacPorts may install or upgrade a number of additional packages prior to installing Mercurial.


You may get an alert dialog that says something like:

<html><pre>
+-----------------------------------------------+
| To open "javac," you need a Java runtime.     |
| Would you like to install one now?            |
|                                               |
|                         (Not Now) ((Install)) |
+-----------------------------------------------+
</pre></html>

Java is no longer distributed with OS X Lion by default, if you need to install it, it can be downloaded from [[http://support.apple.com/kb/DL1421|here]].

Why does mercurial depend on Java? It actually doesn't, possibly one of the packages Mercurial depends on requires Java during its installation. Once Mercurial is installed, Java can be disabled and Mercurial will still function normally. Avoid installing Java as it is the #1 source of exploits and commercially available exploit kits. See http://tantek.com/2010/300/b1/disable-java-now for details/citations. 

Click (Not Now) and hope it works.

You might also get messages like this:

<code>
To make python 2.7 the default (i.e. the version you get when you run
'python'), please run:
    	sudo port select --set python python27
</code>

This is not necessary unless you want to use the MacPorts Python 2.7 environment when invoking Python from the command line. Mercurial will automatically use the MacPorts Python 2.7 environment regardless of which Python version is in your path.

Assuming you don't need javac/Java Runtime, then just maybe:

Congratulations, you've installed the command-line hg tool on your Mac. Mercurial updates frequently, you can upgrade to the latest version of Mercurial at any time by entering the following commands:
<code bash>sudo port selfupdate</code>
You might be asked for your "Password:" again here to sudo. Enter it and press return.

You should then see messages like:
<code>
--->  Updating MacPorts base sources using rsync
MacPorts base version 2.0.3 installed,
MacPorts base version 2.0.3 downloaded.
--->  Updating the ports tree
--->  MacPorts base is already the latest version

The ports tree has been updated. To upgrade your installed ports, you should run
  port upgrade outdated
</code>

Ignore it (unless you want to upgrade all the packages installed on your system by MacPorts).

Now do:

<code bash>sudo port upgrade mercurial</code>

If you already have the latest version of Mercurial, you should not get any messages, just another terminal prompt. If a newer version of Mercurial, or any other packages it depends on, is available, you will see installation messages similar to what you saw during the initial install. If newer packages are installed, you can remove the old ones that are no longer needed by entering:

<code bash>sudo port uninstall outdated</code>

Note that Mercurial is a Python application. Although OS X has Python pre-instaled, MacPorts will install its own version of Python into /opt/local/bin so that it can manage dependencies between packages. This will not interfere with your normal Python installation. Currently, on OS X Mercurial will use Python version 2.7. Note that if you install any extensions to Mercurial via MacPorts, you'll need to use the py27- version of the extension.

Skip to "Configuring Mercurial for use with W3C specs".

==== Linux (Debian-based) ====

  $ sudo apt-get install mercurial
==== Linux (Fedora-based) ====
  # yum install mercurial

===== Configuring Mercurial for use with W3C specs =====
Create a file in your home directory called ".hgrc", or "%USERPROFILE%\mercurial.ini" on Windows.  Give it the following contents, but with the name, email, username, and password replaced appropriately:

  [ui]
  username = Your Full Name <your@email.address.example>
  
  [auth]
  w3c.prefix = https://dvcs.w3.org/hg/
  w3c.username = yourusername
  w3c.password = yourpassword
  
If you don't want to store your password in the config file, you can [[http://mercurial.selenic.com/wiki/KeyringExtension|install the Keyring extension]] and omit the password line. The Keyring extension will prompt you for your password the first time it is needed and store it securely in your system keyring.

If you access the web through a proxy, you'll also need to set that up now. [[http://www.selenic.com/mercurial/hgrc.5.html#http-proxy|Details of proxy settings can be found here]].

===== Using Mercurial to edit a W3C spec =====

Mercurial is a distributed version control system. (See [[tools:hg| Mercurial Quick Guide]] for more information.)

TO DO: explain atomic commits (and how you should use them)

TO DO: explain distributed nature (and attribution of commits) Note: we have the quick guide page (linked above), we should merge all general Mercurial info there, and have this page be only about accessing the specs. The quick guide page is currently targeted towards test suite access, that should be factored into it's own access page.

==== Clone a repository ====

First, you need to clone the repository to your local machine so you have a copy of it.  Go to a command prompt in the parent of the directory you want the repository in, and then run the command:
  hg clone https://dvcs.w3.org/hg/FXTF/
You should then see output like this:
  destination directory: FXTF
  requesting all changes
  adding changesets
  adding manifests
  adding file changes
  added 78 changesets with 799 changes to 642 files
  updating to branch default
  137 files updated, 0 files merged, 0 files removed, 0 files unresolved
This has now created a directory called "FXTF" inside of that directory with all of the FX task force specs

==== hg pull / push ( / incoming / outgoing) ====

==== hg commit / update ( / diff) ====